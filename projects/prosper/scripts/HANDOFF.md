# プロジェクト引継ぎ資料（HANDOFF）：Prosper Publisher

## 1. プロジェクト概要
Markdown形式の渾身の記事を、note.comのエディタ（ProseMirror）へ自動投稿し、雑誌のような高品質なレイアウトで下書き保存するシステム『Prosper Publisher』の開発。

## 2. 現在の到達点 (V1 〜 V5)
最新版： `prosper_publisher_v5_magazine.py`

### 実装済みの機能
- **自動ログイン・セッション維持**: `Playwright` の `launch_persistent_context` を使用し、`.note_user_data` にログイン情報を保存。
- **高度なMarkdownパース**: テキスト、見出し（H2/H3）、引用、区切り線、リストを正確に識別。
- **エディタ制御**: note独自の挙動（ProseMirror）に合わせ、単なる `fill` ではなく `keyboard.type` とショートカットを組み合わせて入力。
- **視覚的装飾の自動化**:
    - **枠線付き引用**: Markdownの `> ` を、枠線付き(Strong Quote)スタイルに変換（`Ctrl+Shift+>` の2回押し）。
    - **区切り線**: `---` を検知し、エディタの「+メニュー」から公式の区切り線（`<hr>`）を挿入。
- **進捗通知（V3試行）**: MacOSの通知機能を用いた進捗報告（※ユーザー要望により一度停止中）。
- **画像生成（V2試行）**: DALL-Eによる『Prosper Minimal』スタイルのバナー自動生成。

## 3. 判明している技術仕様（ProseMirror攻略法）
- **改行の使い分け**: 
    - `Enter`: 新しいブロック（段落）を作成。
    - `Shift + Enter`: 同一ブロック内での改行。
- **引用スタイル**: 
    - 1度適用：通常の引用。
    - 2度適用：グレー背景の枠線付き引用（セクション分けに有効）。
- **バナー設定**: 
    - `button[aria-label="画像を追加"]` -> `text=画像をアップロード` のフローで設定可能。

## 4. 残された課題（次回の注力ポイント）
1.  **「改行」と「ブロック密度」の最適化**:
    - 現在、一ブロックが長すぎたり、逆に空行が多すぎたりする違和感がある。
    - Markdownの空行数をカウントし、note側で「空のブロック（Enter）」をいくつ挟むかのルール化が必要。
2.  **雑誌的なデザインの追求**:
    - 重要な章の冒頭を「枠線付き引用」で括るなど、より「魅せる」構造化。
    - 文章の長さ（N文字以上）で自動的にブロックを分割し、適切なリズムを作る。
3.  **メインバナー・挿入画像の自動化復活**:
    - V2で試行したバナー自動生成・設定を、安定した入力エンジンの上で再統合する。
4.  **進捗可視化の再定義**:
    - ブラウザ上の要素や、より控えめで分かりやすい進捗表示。

## 5. 開発環境
- **言語**: Python 3.13 / Playwright
- **記事データ**: `article_001_fight_club_marketing.md`
- **画像フォルダ**: `images/`
- **保存ディレクトリ**: `/Users/yukinari/Desktop/antigravity/projects/prosper/scripts/`

---
> 🦉 **フクロウのコメント**: 
> 「エディタ内部の魔法（ショートカット）はすべて解明しました。次は『呼吸』を整える番です。改行一つで記事は生きてきます。」
