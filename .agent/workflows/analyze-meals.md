---
description: 食べたもの.mdの写真から栄養解析を行い、Vaultを自動整理する
---

## 🥗 食事解析 & 自動整理ワークフロー

このワークフローは、ユーザーが `食べたもの.md` に写真を貼った後、Antigravityが実行する標準手順です。

### 1. データの検知と抽出
- `食べたもの.md` を読み取り、埋め込まれている画像（`![[image.jpg]]` など）を特定する。
- 特記がなければ「昨日」または「今日（現在時刻から判断）」の食事として扱う。

### 2. 精密解析
- 各画像から料理を特定し、PFC（タンパク質・脂質・炭水化物）とカロリーを算出。
- **重要：ポーション量・スケールの推定**: 
    - 写真内の参照物（食器、手、テーブルの質感など）に基づき、食品の物理的なサイズと体積を推定すること。
    - 「1食分」という標準単位ではなく、目視できる**実際の分量**（例：一口分、半分、山盛り）に基づいて栄養素を算出する。
- ユーザーのダイエット計画と照らし合わせ、辛口な評価を生成。

### 3. Vaultの自動整理 & 画像圧縮
- 画像ファイルを以下のディレクトリへ移動する：
    - `10_Projects/Health/Meal_Log/Attachments/YYYY-MM-DD/`
- **画像圧縮（iCloud容量節約）**:
    - `sips` を使用して、解像度をリサイズ（最大幅800px程度）し、画質を50%程度に落として保存する。
- 解析レポートを以下のパスに生成する：
    - `10_Projects/Health/Meal_Log/Reports/YYYY-MM-DD_食事レポート.md`
- **重要：レポート形式の固定化**: 以下の構造、テーブルレイアウト、およびトーンを厳守すること。
    1. **タイトル**: `<div style="font-size: 0.85em; font-weight: bold; margin-bottom: 8px;">🍴 栄養解析レポート (YYYY-MM-DD)</div>`
    2. **サマリーセクション**: `<div style="font-size: 0.85em;">` で囲み、サマリーテーブルを記述。
    3. **メニュー別ログタイトル**: `<div style="font-size: 0.85em; font-weight: bold; margin-bottom: 8px;">🍽 メニュー別ログ（辛口ツッコミ付）</div>` 
    4. **詳細ログテーブル**: **画像ヘッダー行＋内容行の極シンプル構造。**
       - 構造（最高安定性 ＆ 0.85em ＆ 2列表示）：
         ```markdown
         | ![[image1.jpg\|300]] | ![[image2.jpg\|300]] |
         | :--- | :--- |
         | <div style="font-size: 0.85em; line-height: 1.4;">**1. 料理名**<br>**550kcal**<br>**P15g F20g C75g**<br>**コメント :**<br>内容...<br><br>**辛辣なコメント：**<br>内容...</div> | <div style="font-size: 0.85em; line-height: 1.4;">**2. 料理名**<br>**120kcal**<br>**P8g F6g C10g**<br>**コメント :**<br>内容...<br><br>**辛辣なコメント：**<br>内容...</div> |
         ```
    5. **最終宣告**: `<div style="font-size: 0.85em;">` で囲み、`> [!CAUTION]` を記述。

### 4. 後片付け（クリーンアップ）
- レポート内の画像リンクが移動後のパスを指していることを確認する。
- **重要**: 処理が完了したら `食べたもの.md` の内容をすべて消去し、次の記録に備える。

### 5. 完了通知
- 生成されたレポートのパスをユーザーに提示し、重要な「ツッコミ」を要約して伝える。
